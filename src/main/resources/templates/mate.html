<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">
  <title>Mate Page</title>
 <style>
   body {
     margin: 0;
     padding: 0;
     overflow: hidden;
   }
   .--header {
     display:flex;
     justify-content : space-between;
     align-items : center;
     padding :10px;
     background-color:#FFE08C;
     font-family: "Black Han Sans";
     font-weight: bold;
   }
   .container {
     width: auto;
     min-height: calc(90vh - (40px + (10px * 2)));
     display:flex;
     flex-direction : column;
     justify-content: center;
     align-items: center;
   }
   .--logo-image{
     font-size :30px;
   }
   .--login-container a{
     margin-left :10px;
   }
   .--main{
     padding :20px;
   }
   .--footer{
     text-align:center;
     padding :10px;
     background-color:#f2f2f2;
   }
   .table-container {
       width: 80%;
       margin-top:20px;
   }
   table {
       width:100%;
       border-collapse: collapse;
   }
   thead th, tbody td {
       border-bottom:solid #ddd 1px;
       padding :12px;
       text-align:left;
   }
   tfoot td {
       text-align:center;
       padding-top :20px;
   }
 </style>
</head>
<body>
<header class="--header">
    <div class="--logo">
        <div class="--logo-image">ğŸ” ë§›ìêµ­</div>
    </div>
    <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒê³¼ ë§ˆì´í˜ì´ì§€ ë§í¬ -->
    <div class="--login-container">
        <!-- ë§ˆì´í˜ì´ì§€ì™€ ë¡œê·¸ì•„ì›ƒ ë§í¬ -->
        <a href="/mypage">ë§ˆì´ í˜ì´ì§€</a>
        <!-- ì—¬ê¸°ì„œ /logout ê²½ë¡œëŠ” ê°€ì •í•œ ê²ƒì…ë‹ˆë‹¤ -->
        <a href="#" id="logout-button" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
    <!-- ë¡œê·¸ì¸ ë§í¬ -->
    <div class="--not-login-container" style="display: none;">
        <a href="/login">ë¡œê·¸ì¸</a>
    </div>
</header>

<main class="--main">
    <div class="container table-container">
        <table>
            <thead>
             <th class="col-md-1">ë²ˆí˜¸</th>
             <th class="col-md-1">ì œëª©</th>
             <th class="col-md-1">ìƒíƒœ</th>
             <th class="col-md-1">ë°©ë¬¸ ë‚ ì§œ</th>
            </thead>
            <tbody th:id="postListTableBody">
            <script th:inline="javascript">
                /* ì„œë²„ë¡œë¶€í„° ë°›ì€ postList ë°ì´í„° */
                var postListData = [[${post}]] [];
                for(var i=0; i<postListData.length; i++) {
                    var rowIdAttrVal = 'row-' + postListData[i].id;

                    /* ê²Œì‹œê¸€ ëª©ë¡ ì¶”ê°€ */
                    $('#postListTableBody').append('<tr id="'+rowIdAttrVal+'">' +
                        '<td>'+postListData[i].id+'</td>' +
                        '<td>'+postListData[i].title+'</td>' +
                        '<td>'+postListData[i].status+'</td>' +
                        '<td>'+formatDate(postListData[i].visitDate)+'</td>' +
                        '<td><a href="/post/'+postListData[i].id+'">ìì„¸íˆ ë³´ê¸°</a></td>' +
                        '</tr>');
                }

                /* ë‚ ì§œ í¬ë§· ë³€í™˜ í•¨ìˆ˜ */
                function formatDate(dateStr) {

                    var dateObj = new Date(dateStr);
                    var year = dateObj.getFullYear();
                    var month = ("0" + (dateObj.getMonth() + 1)).slice(-2);
                    var day = ("0" + dateObj.getDate()).slice(-2);
                    var hours=("0"+dateObj.getHours()).slice(-2);
                    var minutes=("0"+dateObj.getMinutes()).slice(-2);

                    return year + '-' + month + '-' + day +' '+hours+':'+minutes ;
                }
            </script>
            <tr th:each="post : ${postList}">
                <td th:text="${post.id}"></td>
                <td th:text="${post.title}"></td>
                <td th:text="${post.status}"></td>
                <td th:text="${#temporals.format(post.visitDate,'yyyy-MM-dd HH:mm')}"></td>
                <td><a th:href="@{'/post/' + ${post.id}}" >ìì„¸íˆ ë³´ê¸°</a></td>
            </tr>
            </tbody>
        </table>

    </div>
</main>

<footer class="--footer">
  Â©2023 Mutsa-Backend-School-JDK17. All rights reserved.
</footer>
<script>
    document.getElementById('logout-button').addEventListener('click', function(event) {
        event.preventDefault(); // ê¸°ë³¸ í´ë¦­ ë™ì‘ ë§‰ê¸°
        logout(); // logout í•¨ìˆ˜ í˜¸ì¶œ
    });
    function logout() {
        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì½”ë“œ ì‘ì„±
        // ì˜ˆ: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° ì œê±°, ì„œë²„ì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ë“±
        const token = localStorage.getItem('token');

        if (token) {
            fetch('/logout', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
                .then(response => {
                    if (response.status === 200) {
                        // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ ì²˜ë¦¬
                        localStorage.removeItem('token');
                        window.location.href = '/main'; // í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    } else {
                        // ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
                        console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', response.statusText);
                    }
                })
                .catch(error => {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                });
        } else {
            // í† í°ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
            console.error('í† í°ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì—†ìŠµë‹ˆë‹¤.');
        }
    }
</script>
<script>
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í† í° í™•ì¸
    window.onload = function() {
        const token = localStorage.getItem('token');
        const loginContainer = document.querySelector('.--login-container');
        const notLoginContainer = document.querySelector('.--not-login-container');

        if (token) {
            // ë¡œê·¸ì¸ ìƒíƒœ
            loginContainer.style.display = 'block';
            notLoginContainer.style.display = 'none';
        } else {
            // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
            loginContainer.style.display = 'none';
            notLoginContainer.style.display = 'block';
        }
    }
</script>
<!--<script>-->
<!--    fetch('/reissue', {-->
<!--        method: 'POST',-->
<!--        credentials: 'include' // ì¿ í‚¤ ì „ì†¡ì„ ìœ„í•´ í•„ìš”í•œ ì˜µì…˜-->
<!--    })-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            console.log(data);-->
<!--            localStorage.setItem('token', data.accessToken);-->
<!--            // í˜ì´ì§€ ë¦¬ë¡œë“œ? ë‹¤ìŒ ì‘ì—…?-->
<!--        })-->
<!--        .catch(error => {-->
<!--            console.error('ì¬ë°œê¸‰ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);-->
<!--        });-->
<!--</script>-->
</body>
</html>